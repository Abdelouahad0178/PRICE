<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chat Pro Firebase</title>
  <meta name="description" content="Chat style WhatsApp avec Firebase.">
  <link rel="icon" href="favicon.png">
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="favicon.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
  <style>
    html,body{height:100%;margin:0;}
    body{background:#111b21;color:#e9edef;font-family:"Segoe UI",Arial,sans-serif;}
    .container{display:flex;flex-direction:column;min-height:100vh;}
    header{background:#25d366;color:white;padding:18px 28px;font-size:22px;display:flex;align-items:center;}
    .hamburger {display:inline-flex;background:none;border:none;color:#fff;font-size:24px;margin-right:12px;cursor:pointer;}
    main{flex:1;display:flex;}
    aside#sidebar{
      width:310px;background:#111b21;border-right:1px solid #2a3942;
      display:flex;flex-direction:column;transition:left .25s, box-shadow .25s;
      position:fixed;z-index:100;left:-100vw;top:0;bottom:0;height:100vh;
      box-shadow:2px 0 16px rgba(0,0,0,0.13);
      max-width:95vw;
    }
    aside#sidebar.open { left:0; box-shadow:2px 0 16px rgba(0,0,0,0.22);}
    .backdrop-sidebar {
      display:none;position:fixed;z-index:99;left:0;top:0;right:0;bottom:0;
      background:rgba(0,0,0,.25);
      transition:opacity .2s;
    }
    .backdrop-sidebar.show {display:block;}
    .profile{padding:18px;display:flex;align-items:center;gap:13px;border-bottom:1px solid #2a3942;}
    .profile .avatar{width:48px;height:48px;border-radius:50%;background:#25d366;display:flex;align-items:center;justify-content:center;color:white;font-size:21px;font-weight:bold;}
    .profile .infos{flex:1;}
    .profile .infos .name{font-weight:600;}
    .profile .infos .status{font-size:12px;color:#25d366;}
    .search{padding: 11px 14px;border-bottom:1px solid #2a3942;}
    .search input{width:100%;padding:8px 14px;border-radius:24px;border:none;}
    .contacts{flex:1;overflow-y:auto;}
    .contact{display:flex;align-items:center;gap:12px;padding:14px;cursor:pointer;border-bottom:1px solid #2a3942;transition:background .2s;}
    .contact:hover,.contact.active{background:#232d36;}
    .contact .avatar{width:38px;height:38px;border-radius:50%;background:#4ecca3;display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;}
    .contact .details{flex:1;}
    .contact .details .cname{font-weight:500;font-size:15px;}
    .contact .details .clast{font-size:11px;color:#bbb;}
    .contact .del-contact {
      margin-left:auto;
      background:#e53e3e;
      color:#fff;
      border:none;
      border-radius:50%;
      width:24px;
      height:24px;
      font-size:13px;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    main {flex:1;}
    .chat{flex:1;display:flex;flex-direction:column;background:#0b141a;min-width:0;}
    .chat-header{padding:12px 17px;border-bottom:1px solid #2a3942;display:flex;align-items:center;gap:10px;}
    .chat-header .avatar{width:35px;height:35px;border-radius:50%;background:#4ecca3;display:flex;align-items:center;justify-content:center;color:white;}
    .chat-header .cname{font-weight:600;}
    .chat-header .cstatus{font-size:12px;color:#bbb;}
    .chat-header .actions{margin-left:auto;display:flex;gap:7px;}
    .chat-header .actions button{background:#25d366;color:white;border:none;border-radius:50%;width:32px;height:32px;font-size:15px;}
    .messages{flex:1;padding:13px 10px 10px 10px;overflow-y:auto;display:flex;flex-direction:column;gap:9px;}
    .msg{max-width:80%;padding:8px 12px;border-radius:14px;font-size:13px;line-height:1.5;box-shadow:0 2px 8px rgba(0,0,0,0.10);}
    .msg.sent{align-self:flex-end;background:linear-gradient(135deg,#25d366,#128c7e);color:white;border-bottom-right-radius:5px;}
    .msg.rcv{align-self:flex-start;background:#232d36;color:#e9edef;border-bottom-left-radius:5px;}
    .msg .meta{font-size:9px;color:#aaa;margin-top:4px;}
    .msg img,.msg video{max-width:180px;border-radius:7px;margin-top:6px;}
    .msg audio{width:170px;}
    .input-area{display:flex;align-items:center;gap:8px;padding:10px 9px 10px 9px;border-top:1px solid #2a3942;}
    .input-area input[type="file"]{display:none;}
    .input-area textarea{
      flex: 1 1 33%;
      min-width: 33vw;
      width: 100%;
      resize: none;
      border: none;
      border-radius: 15px;
      padding: 12px 17px;
      font-size: 16px;
      background: #202c33;
      color: #fff;
      min-height: 40px;
      max-height: 80px;
      height: 56px;
      transition: all .2s;
    }
    .input-area button{background:#25d366;color:white;border:none;border-radius:50%;width:36px;height:36px;font-size:15px;}
    .input-area label{font-size:19px;cursor:pointer;}
    @media (max-width:600px) {
      .input-area textarea{ min-width:0; }
    }
  </style>
</head>
<body>
<div class="container">
  <header>
    <button id="toggleAside" class="hamburger" title="Afficher contacts">
      <i class="fa fa-bars"></i>
    </button>
    <i class="fa fa-whatsapp"></i> Chat Pro Firebase
  </header>
  <div id="backdrop-sidebar" class="backdrop-sidebar"></div>
  <main>
    <aside id="sidebar">
      <div class="profile">
        <div class="avatar" id="my-avatar">ðŸ‘¤</div>
        <div class="infos">
          <div class="name" id="my-name-block">
            <span id="my-name">Moi</span>
            <button id="edit-my-name" title="Changer mon nom" style="background:none;border:none;cursor:pointer;color:#25d366;padding:0 0 0 7px;">
              <i class="fa fa-pen"></i>
            </button>
          </div>
          <input id="my-name-input" style="display:none;margin-top:4px;width:95%;padding:4px 9px;border-radius:13px;border:none;" placeholder="Votre nom..." maxlength="30"/>
          <div class="status" id="my-status">Hors ligne</div>
        </div>
      </div>
      <div class="search"><input id="searchContact" type="text" placeholder="Recherche contact..."></div>
      <div class="contacts" id="contacts"></div>
    </aside>
    <section class="chat">
      <div class="chat-header">
        <div class="avatar" id="c-avatar">?</div>
        <div>
          <div class="cname" id="c-name">SÃ©lectionnez un contact</div>
          <div class="cstatus" id="c-status">...</div>
        </div>
        <div class="actions">
          <button id="callAudioBtn" title="Appel audio"><i class="fa fa-phone"></i></button>
          <button id="callVideoBtn" title="Appel vidÃ©o"><i class="fa fa-video"></i></button>
          <button id="hangupBtn" title="Raccrocher" style="display:none;"><i class="fa fa-phone-slash"></i></button>
        </div>
      </div>
      <div class="messages" id="messages"></div>
      <video id="remoteVideo" style="display:none; max-width:367px;margin:3px 6px 61px 24px; border-radius:10px;" autoplay playsinline></video>
      <audio id="remoteAudio" style="display:none;" autoplay></audio>
      <div class="input-area">
        <label for="img-input"><i class="fa fa-image"></i></label>
        <input type="file" id="img-input" accept="image/*">
        <label for="vid-input"><i class="fa fa-video"></i></label>
        <input type="file" id="vid-input" accept="video/*">
        <label id="audio-btn" title="Envoyer un audio"><i class="fa fa-microphone"></i></label>
        <textarea id="msg-input" rows="1" placeholder="Message..."></textarea>
        <button id="send-btn"><i class="fa fa-paper-plane"></i></button>
      </div>
    </section>
  </main>
</div>
<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-storage-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js"></script>
<!-- PeerJS pour appels -->
<script src="https://cdn.jsdelivr.net/npm/peerjs@1.5.2/dist/peerjs.min.js"></script>
<script src="firebase-config.js"></script>
<script src="societe.js"></script>
</body>
</html>
